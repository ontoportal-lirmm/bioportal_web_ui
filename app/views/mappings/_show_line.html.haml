- process = map.process || {}
- type_tooltip = "#{map.source} #{process[:source_name]}".strip
- type = "#{type_tooltip[0]}#{type_tooltip[-1]}".upcase #take the first and last letters
- relations = process[:relation]&.each { |relation| get_prefixed_uri(relation)}
- map_id = map.id.to_s.split("/").last
- target_concept = map.classes.select {|target_concept| target_concept.id != concept.id && target_concept.links['ontology'] != concept.links['ontology']}.first || map.classes.last

- if inter_portal_mapping?(target_concept)
  - cls_link = ajax_to_inter_portal_cls(target_concept)
  - ont_name = target_concept.links['ontology']
  - ont_acronym = ont_name
  - ont_link = link_to ont_acronym , get_inter_portal_ui_link(target_concept.links['ontology'], process["name"]), target: '_blank'
  - source = 'I-P'
  - source_tooltip = "Internal portal"
- elsif internal_mapping?(target_concept)
  - begin
    - ont = target_concept.explore.ontology
    - ont_name = ont.acronym
    - ont_link =  link_to ont_name, ontology_path(ont_name), 'data-turbo-frame':'_top'
  - rescue
    - ont_name =   target_concept.links['ontology'] || target_concept.id
    - ont_link =   ont_name
  - cls_link = raw(get_link_for_cls_ajax(target_concept.id, ont_name, '_top'))
  - source = inline_svg_tag 'summary/homepage.svg', class: 'mappings-table-icon'
  - source_tooltip = "Internal"
- else
  - cls_label = get_label_for_external_cls(target_concept.links["self"])
  - cls_link = raw("<a href='#{target_concept.links["self"]}' target='_blank'>#{cls_label}</a>")
  - ont_name = target_concept.links['ontology']
  - ont_link = link_to ont_name, target_concept.links['ontology'], target: "_blank"
  - source = inline_svg_tag 'icons/external-link.svg', class: 'mappings-table-icon', width: '20px', height: '20px'
  - source_tooltip = "External"
  
%tr.human{:id => map_id}
  %td.mappings-table-mapping-to
    = cls_link
  %td{style: "width: 30%"}
    = ont_link
  - if relations
    %td
      - relations&.each do  |r|
        = r
        %br/

  %td
    .d-flex.justify-content-center{'data-controller': 'tooltip', title: type_tooltip, style: 'font-weight: bold;'}
      = type
  %td
    .d-flex.justify-content-center{'data-controller': 'tooltip', title: source_tooltip}
      #{source}
      - if !process.nil?
        - if translation?(process["relation"])
          %img{:src => asset_path('sifr/english_language_flag.png'), :style => "padding: 5px", :align => "right", :title => "Traduction"}
  - if current_user_admin?
    %td{:class => 'delete_mappings_column'}
      - if map.id && !map.id.empty? && session[:user] && (session[:user].id.to_i == map.creator || session[:user].admin?) && map.source.eql?('REST')
        %div.d-flex
          = link_to_modal(t("mappings.show_line.edit_modal"),
                  mapping_path(map_id, {conceptid_from: @concept.id}),
                  role: "button",
                  class: "btn btn-link",
                  data: { show_modal_title_value: t("mappings.show_line.edit_mapping", preflabel: @concept.prefLabel)},
                  )
          = button_to t("mappings.show_line.delete_button"), CGI.unescape(mapping_path(map.id)), method: :delete, class:'btn btn-link',  form: {data: { turbo: true, turbo_confirm: t("mappings.show_line.turbo_confirm"), turbo_frame: '_top'}}
  